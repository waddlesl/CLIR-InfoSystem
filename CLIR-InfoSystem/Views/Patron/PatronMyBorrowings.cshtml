@model IEnumerable<CLIR_InfoSystem.Models.BookBorrowing>

<div class="container mt-3">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="fw-bold mb-0">My Current Borrowings</h4>
            <small class="text-muted">
                @DateTime.Now.ToString("MMM dd, yyyy | dddd, h:mm tt")
            </small>
        </div>

        <!-- SEARCH -->
        <div class="input-group" style="max-width: 300px;">
            <span class="input-group-text bg-white border-end-0">
                <i class="bi bi-search text-muted"></i>
            </span>
            <input type="text"
                   id="borrowSearch"
                   class="form-control border-start-0"
                   placeholder="Search Book Title...">
        </div>
    </div>

    <!-- CARD -->
    <div class="card shadow-sm border-0">

        <div class="card-body p-4">

            <!-- TABLE -->
            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead class="small text-muted">
                        <tr>
                            <th>Book Title</th>
                            <th>Borrow Date</th>
                            <th>Due Date</th>
                            <th class="text-end">Status</th>
                        </tr>
                    </thead>
                    <tbody id="borrowTableBody">
                        @foreach (var loan in Model)
                        {
                            <tr>
                                <td class="fw-semibold">@loan.Book?.Title</td>
                                <td>@loan.BorrowDate.ToString("MMM dd, yyyy")</td>
                                <td>
                                    @(loan.Status == "Reserved"
                                                                    ? "---"
                                                                    : loan.DueDate?.ToString("MMM dd, yyyy"))
                                </td>
                                <td class="text-end">
                                    @if (loan.Status == "Reserved")
                                    {
                                        <span class="capsule capsule-info">Reserved</span>
                                    }
                                    else if (loan.Status == "Overdue")
                                    {
                                        <span class="capsule capsule-danger">@loan.Status</span>
                                    }
                                    else if (loan.Status == "Borrowed")
                                    {
                                        <span class="capsule capsule-primary">@loan.Status</span>
                                    }
                                    else if (loan.Status == "Returned")
                                    {
                                        <span class="capsule capsule-success">@loan.Status</span>
                                    }
                                    else
                                    {
                                        <span class="capsule capsule-warning">@loan.Status</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>

        <!-- FOOTER AREA (for consistency even without pagination) -->
        <div class="card-footer bg-white border-0 py-3">
            <div class="d-flex justify-content-between align-items-center">
                <div class="small text-muted">
                    Total Records: @Model.Count()
                </div>
                <div></div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        // Real-time Search Logic (unchanged)
        $("#borrowSearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#borrowTableBody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    </script>

    <style>
        .page-link {
            color: #1a2035;
        }

        .page-item.active .page-link {
            background-color: #1a2035;
            border-color: #1a2035;
            color: white;
        }

        .capsule {
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            min-width: 80px; /* Ensures consistent width for different status text */
            text-align: center;
        }

        .capsule-success {
            background: #d1e7dd;
            color: #0f5132;
        }

        .capsule-primary {
            background: #cfe2ff;
            color: #084298;
        }

        .capsule-info {
            background: #cff4fc;
            color: #055160;
        }

        .capsule-danger {
            background: #f8d7da;
            color: #842029;
        }

        .capsule-warning {
            background: #fff3cd;
            color: #664d03;
        }
    </style>


}
