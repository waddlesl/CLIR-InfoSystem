<form method="get">
    <!--FOR GAT-->
    <input type="hidden" name="service" value="@Context.Request.Query["service"]" />
    <select id="yearDropdown" name="selectedYear" class="form-control mb-2">
    </select>

    <select id="termDropdown" name="selectedTerm" class="form-control mb-2">
        <option value="">Select Term (Full Year)</option>
        <option value="1" selected="@(Context.Request.Query["selectedTerm"] == "1")">1st Term</option>
        <option value="2" selected="@(Context.Request.Query["selectedTerm"] == "2")">2nd Term</option>
        <option value="3" selected="@(Context.Request.Query["selectedTerm"] == "3")">3rd Term</option>
    </select>

    <button type="submit" class="btn-red mt-3">Filter</button>
    <button type="submit" asp-controller="Report" asp-action="DownloadReport" class="btn-red mt-3">Download PDF</button>
</form>

<br/>

<script>
    // Using a function that executes immediately to avoid timing issues
    (function populateYears() {
        const selectElement = document.getElementById('yearDropdown');
        if (!selectElement) return; 

        const urlParams = new URLSearchParams(window.location.search);
        const selectedYearFromUrl = urlParams.get('selectedYear');

        const currentYear = new Date().getFullYear();
        const yearsToInclude = 5;

        // Clear existing options
        selectElement.innerHTML = '';

        for (let i = 0; i <= yearsToInclude; i++) {
            const year = currentYear - i;
            const option = document.createElement('option');
            option.value = year;
            option.text = year;

            if (selectedYearFromUrl == year) {
                option.selected = true;
            } else if (!selectedYearFromUrl && i === 0) {
                option.selected = true;
            }

            selectElement.appendChild(option);
        }
    })();
</script>