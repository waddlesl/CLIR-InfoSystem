<form method="get" class="row g-2 align-items-end">
    <input type="hidden" name="service" value="@Context.Request.Query["service"]" />

    <div class="col-md-3">
        <label class="small fw-bold text-muted mb-1">Academic Year</label>
        <select id="yearDropdown" name="selectedYear" class="form-select shadow-sm">
        </select>
    </div>

    <div class="col-md-3">
        <label class="small fw-bold text-muted mb-1">Term Period</label>
        <select id="termDropdown" name="selectedTerm" class="form-select shadow-sm">
            <option value="">Full Academic Year</option>
            <option value="1" selected="@(Context.Request.Query["selectedTerm"] == "1")">1st Term (Aug - Nov)</option>
            <option value="2" selected="@(Context.Request.Query["selectedTerm"] == "2")">2nd Term (Dec - Mar)</option>
            <option value="3" selected="@(Context.Request.Query["selectedTerm"] == "3")">3rd Term (Apr - Jul)</option>
        </select>
    </div>

    <div class="col-md-5 d-flex gap-2">
        <button type="submit" class="btn btn-primary shadow-sm flex-grow-1">
            <i class="fas fa-filter me-1"></i> Apply Filter
        </button>
        <button type="submit" asp-controller="Report" asp-action="DownloadReport" class="btn btn-outline-danger shadow-sm flex-grow-1">
            <i class="fas fa-file-pdf me-1"></i> Export General PDF
        </button>
    </div>
</form>

<script>
    (function populateYears() {
        const selectElement = document.getElementById('yearDropdown');
        if (!selectElement) return;

        const urlParams = new URLSearchParams(window.location.search);
        const selectedYearFromUrl = urlParams.get('selectedYear');

        const currentYear = new Date().getFullYear();
        const yearsToInclude = 5;

        selectElement.innerHTML = '';

        for (let i = 0; i <= yearsToInclude; i++) {
            const year = currentYear - i;
            const option = document.createElement('option');
            // Academic year format often looks like 2023-2024,
            // but we'll keep the value as the integer for your controller logic.
            option.value = year;
            option.text = `AY ${year}-${year + 1}`;

            if (selectedYearFromUrl == year) {
                option.selected = true;
            } else if (!selectedYearFromUrl && i === 0) {
                option.selected = true;
            }

            selectElement.appendChild(option);
        }
    })();
</script>