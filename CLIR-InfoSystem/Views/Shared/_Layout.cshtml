@using Microsoft.AspNetCore.Http
@{
    // Retrieve the user role from the session
    var role = Context.Session.GetString("UserRole");
    var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - CLIR System</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Top Banner */
        .top-banner {
            background-color: #1a2035;
            color: white;
            padding: 12px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand-text { font-size: 0.85rem; line-height: 1.2; font-weight: bold; }
        .logout-link { color: white; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .logout-link:hover { opacity: 0.7; color: #ff4d4d; }

        /* Sidebar Layout */
        .wrapper { display: flex; }

        .sidebar {
            width: 240px;
            background: #1a2035;
            min-height: calc(100vh - 58px);
            color: #b5b5b5;
            display: flex;
            flex-direction: column;
        }

        .nav-group-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            padding: 20px 20px 5px 20px;
            color: #6e7a91;
            font-weight: bold;
        }

        .nav-item {
            padding: 12px 20px;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav-item a {
            color: inherit;
            text-decoration: none;
            display: block;
            width: 100%;
        }

        .nav-item:hover, .nav-active {
            background: #2b3553;
            color: white !important;
            border-left: 4px solid #d92d20; /* Red accent */
        }

        .main-content {
            flex: 1;
            padding: 30px;
            background: #f8f9fa;
            min-height: calc(100vh - 58px);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 20px;
            font-size: 0.8rem;
            color: #6e7a91;
        }

        .acceptbuttons{
            padding: 2px 4px;
            text-decoration: none;
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 5px;
            font-size: 16px; 
            text-align: center;
        }

        .denybuttons {
            padding: 2px 4px;
            text-decoration: none;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        /*For Disabled <a> tag*/
        .disabled-link {
            color: #94a3b8 !important; 
            pointer-events: none; 
            cursor: default; 
            text-decoration: none;
            opacity: 0.6;
        }


        /*For ReportDashboard*/
        #reports-page-container {
            padding: 2rem;
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        .section-subtitle {
            font-weight: 700;
            color: #334155;
            margin: 1.5rem 0;
            font-size: 1.5rem;
        }


        .report-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.6rem 1.2rem;
            text-decoration: none;
            color: #64748b;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-weight: 600;
            transition: all 0.2s ease;
        }

            .tab:hover {
                background: #f1f5f9;
                color: #1e293b;
            }

            .tab.active {
                background: #1e293b;
                color: white;
                border-color: #1e293b;
            }


        .stats-row-top {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .report-card {
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .dark-card {
            background-color: #1e293b;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .graph-placeholder {
            background-color: white;
            border: 1px solid #e2e8f0;
        }


        .card-label {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .dark-card .card-label {
            color: #cbd5e1;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
        }

            .card-value.highlight {
                color: #ef4444;
            }

        .graph-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 150px;
        }

        .simple-bar-container {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 100px;
            width: 100%;
            margin-top: 1rem;
        }

        .bar {
            flex: 1;
            background: #f87171;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }


        ul li span {
            color: #475569;
            font-size: 0.9rem;
        }

        ul li strong {
            color: #1e293b;
        }

    </style>
</head>
<body>
    <div class="top-banner">
        <div class="d-flex align-items-center">
            <div class="brand-text">
                CENTER FOR LEARNING AND INFORMATION RESOURCES<br />
                <small style="font-weight: normal; opacity: 0.8;">MAPÚA MALAYAN COLLEGES LAGUNA</small>
            </div>
        </div>
        <a asp-controller="Account" asp-action="Logout" class="logout-link">Logout ⏻</a>
    </div>

    <div class="wrapper">
        <div class="sidebar">
            <div class="nav-item @(currentAction.Contains("Dashboard") ? "nav-active" : "")"> 
                <a asp-controller="Dashboard" asp-action="Index">Home</a>
            </div>

            @* Admin Only Menu *@
            @if (role == "Admin")
            {
                <div class="nav-item">
                    <a asp-controller="Account" asp-action="ManageStaff">Staff Management</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Report" asp-action="SystemReport">System Reports</a>
                </div>
            }

            @* Librarian / Staff Menu *@
            @if (role == "Librarian" || role == "Admin")
            {
                <div class="nav-item">
                    <a asp-controller="Patron" asp-action="ManagePatrons">Patron Management</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Book" asp-action="BookManagement">Book Catalog</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Book" asp-action="BookBorrowers">Manage Borrowers</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Facility" asp-action="ManageBookings">Seat Reservations</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Service" asp-action="ManageODDS">Digital Service Requests</a>
                </div>
                <div class="nav-item">
                    <a asp-controller="Report" asp-action="ReportAndAnalytics">Reports & Analytics</a>
                </div>
            }

            @* Student Assistant Menu *@
            @if (role == "Student Assistant")
            {
                <div class="nav-item">
                    <a asp-controller="Book" asp-action="BookManagement">View Catalog</a>
                </div>
                <div class="nav-item">
                    <a href="#">Help Desk</a>
                </div>
            }

            @* PATRON LINKS *@
            @if (role == "Patron")
            {
                <div class="nav-group-label">Library Services</div>
                <div class="nav-item"><a href="#">📖 Catalog</a></div>
                <div class="nav-item"><a href="#">📚 My Loans</a></div>
                <div class="nav-item"><a href="#">📩 Service Requests</a></div>
                <div class="nav-item"><a href="#">🪑 Seat Reservation</a></div>
                <div class="nav-item"><a href="#">👤 My Records</a></div>
            }

            <div class="sidebar-footer">
                ⚙ Options
            </div>
        </div>

        <div class="main-content">
            @RenderBody()
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>