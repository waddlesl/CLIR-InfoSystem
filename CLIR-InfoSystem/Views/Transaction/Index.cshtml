@model IEnumerable<CLIR_InfoSystem.Models.BookBorrowing>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">My Current Borrowings</h2>
        <p class="text-muted small">@DateTime.Now.ToString("MMM dd, yyyy | dddd, h:mm tt")</p>
    </div>

    <div class="card shadow-sm border-0 p-4">
        <div class="d-flex justify-content-end mb-3">
            <div class="input-group" style="max-width: 300px;">
                <span class="input-group-text bg-white border-end-0">
                    <i class="bi bi-search text-muted"></i>
                </span>
                <input type="text" id="borrowSearch" class="form-control border-start-0" placeholder="Search Book Title...">
            </div>
        </div>

        <div class="table-responsive">
            <table class="table align-middle">
                <thead class="small text-muted">
                    <tr>
                        <th>Book Title</th>
                        <th>Borrow Date</th>
                        <th>Due Date</th>
                        <th class="text-end">Status</th>
                    </tr>
                </thead>
                <tbody id="borrowTableBody">
                    @foreach (var loan in Model)
                    {
                        <tr>
                            <td class="fw-semibold">@loan.Book?.Title</td>
                            <td>@loan.BorrowDate.ToString("MMM dd, yyyy")</td>
                            <td>
                                @(loan.Status == "Reserved" ? "---" : loan.DueDate?.ToString("MMM dd, yyyy"))
                            </td>
                            <td class="text-end">
                                @if (loan.Status == "Reserved")
                                {
                                    <span class="badge bg-info text-dark px-3">Reserved</span>
                                }
                                else if (loan.Status == "Overdue")
                                {
                                    <span class="badge bg-danger px-3">@loan.Status</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning text-dark px-3">@loan.Status</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Real-time Search Logic for Borrowings
        $("#borrowSearch").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#borrowTableBody tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    </script>
}